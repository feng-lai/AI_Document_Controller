
# ูุซุงุฆู ูุญุฏุฉ ุงูุชุญูู Record.php

๐ ูุชููุฑ ุจู:  
[English (README.md)](README.md) | [ๆฅๆฌ่ช (README-jp.md)](README-jp.md) | [Espaรฑol (README-es.md)](README-es.md) | [Portuguรชs (README-pt.md)](README-pt.md)

## ุบุฑุถ ุงูููู
ุชุชุนุงูู ูุฐู ุงููุญุฏุฉ ูุน ุงุณุชุฑุฌุงุน ุณุฌูุงุช ุชุงุฑูุฎ ุงููุดู/ุฅุนุงุฏุฉ ุงููุชุงุจุฉ ููุฐูุงุก ุงูุงุตุทูุงุนู ุถูู ุชุทุจูู ุฅุทุงุฑ ุนูู ThinkPHP.

## ุงููุธููุฉ ุงูุฃุณุงุณูุฉ `Index()`

### ุงููุธุงุฆู
- ุงุณุชุฑุฌุงุน ุณุฌูุงุช ูุดู ุฃู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงููุณุชุฎุฏู ุงูุญุงูู  
- ุฏุนู ุงููุชุงุฆุฌ ูุน ุงูุชุฑููู ุงูุตูุญู  
- ุชุตูุฑ ูุชุงุฆุฌ ุงููุดู ูุณูููุฉ ุงููุฑุงุกุฉ

### ูุนููุงุช ุงูุทูุจ
| ุงููุนููุฉ    | ุงูููุน | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ | ุงููุตู                       |
|------------|-------|--------------------|----------------------------|
| type       | int   | 1                  | ููุน ุงูุณุฌู (1=ูุดูุ 2=ุฅุนุงุฏุฉ ูุชุงุจุฉ) |
| page_size  | int   | 10                 | ุนุฏุฏ ุงูุนูุงุตุฑ ูู ุงูุตูุญุฉ       |

### ุดุฑุญ ููุทู ุงูููุฏ

```php
public function Index()
{
    // 1. ุงูุญุตูู ุนูู ูุนููุงุช ุงูุทูุจ
    $type = input('type', 1);
    $limit = input('page_size', '10', 'intval');
    
    // 2. ุจูุงุก ุดุฑูุท ุงูุงุณุชุนูุงู
    $where = [
        ['site_id', '=', self::$site_id],
        ['user_id', '=', self::$user['id']],
        ['is_delete', '=', 0]
    ];
    
    // 3. ุงุฎุชูุงุฑ ุงูุฌุฏูู ุฏููุงูููููุง
    $dbName = ($type == 1) ? 'msg_detect' : 'msg_wyccheck';
    
    // 4. ุงุณุชุนูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    $list = Db::name($dbName)
        ->where($where)
        ->field('id,message_input,response,create_time')
        ->order('id desc')
        ->paginate($limit)
        ->toArray();
    
    // 5. ูุนุงูุฌุฉ ุงูุจูุงูุงุช
    foreach ($list['data'] as $k => $v) {
        $list['data'][$k]['num'] = mb_strlen($v['message_input'], 'utf8');
        $list['data'][$k]['num2'] = mb_strlen($v['response'], 'utf8');
        $list['data'][$k]['create_time'] = date('Y-m-d H:i:s', $v['create_time']);
        
        if($type == 1){
            $response = json_decode($v['response'], true);
            if(isset($response['percent'])){
                $text = 'ูุชุงุจุฉ ูุฎุชูุทุฉ';
                if($response['percent'] == 0) $text = 'ูุชุงุจุฉ ุจุดุฑูุฉ';
                if($response['percent'] == 100) $text = 'ููุดุฃุฉ ุจูุงุณุทุฉ AI';
                
                $list['data'][$k]['response'] = $text.'(ูุนุฏู AI:'.$response['percent'].'%)';
            }
        }
    }
    
    // 6. ุฅุฑุฌุงุน ุงูุงุณุชุฌุงุจุฉ ุงูููุณูุฉ
    return successJson(['list' => $list]);
}
````

### ูุนุงูุฌุฉ ุงูุจูุงูุงุช

1. **ุญุณุงุจ ุทูู ุงููุต**

   * `num`: ุทูู ุงููุต ุงูุฃุตูู
   * `num2`: ุทูู ุงููุชูุฌุฉ ุจุนุฏ ุงููุนุงูุฌุฉ ุจูุงุณุทุฉ AI
   * ูุณุชุฎุฏู `mb_strlen()` ูุญุณุงุจ ุงูุฃุญุฑู ูุชุนุฏุฏุฉ ุงูุจุงูุช ุจุฏูุฉ

2. **ุชุตูุฑ ุงููุดู** (ููุน=1 ููุท)

   * ุชุญููู ุญูู `response` ุจุตูุบุฉ JSON
   * ุชุญููู ูููุฉ `percent` ุฅูู ุตูุบุฉ ูุงุจูุฉ ูููุฑุงุกุฉ:

     * 0% โ "ูุชุงุจุฉ ุจุดุฑูุฉ"
     * 100% โ "ููุดุฃุฉ ุจูุงุณุทุฉ AI"
     * ุฃุฎุฑู โ "ูุชุงุจุฉ ูุฎุชูุทุฉ"
   * ุตูุบุฉ ุงูุฅุฎุฑุงุฌ: `ููุดุฃุฉ ุจูุงุณุทุฉ AI(ูุนุฏู AI:100%)`

3. **ุชูุณูู ุงูููุช**

   * ุชุญููู ุงูุทุงุจุน ุงูุฒููู ุฅูู ุตูุบุฉ `Y-m-d H:i:s`

### ููุฒุงุช ุงูุฃูุงู

* ุดุฑูุท ุงุณุชุนูุงู ุตุงุฑูุฉ: ุงููููุน ุงูุญุงููุ ุงููุณุชุฎุฏู ุงูุญุงููุ ุงูุณุฌูุงุช ุบูุฑ ุงููุญุฐููุฉ
* ุชูููุฉ ุงููุนููุงุช (ุงุณุชุฎุฏุงู `intval`)
* ุงุฎุชูุงุฑ ุงูุฌุฏูู ุฏููุงูููููุง ูุนุฒู ุงูุจูุงูุงุช

### ูููู ุงูุงุณุชุฌุงุจุฉ

```json
{
  "list": {
    "data": [
      {
        "id": 123,
        "message_input": "ุงููุต ุงูุฃุตูู",
        "response": "ููุดุฃุฉ ุจูุงุณุทุฉ AI(ูุนุฏู AI:100%)",
        "create_time": "2025-06-15 14:30:00",
        "num": 24,
        "num2": 18
      }
    ],
    "total": 45,
    "per_page": 10,
    "current_page": 1,
    "last_page": 5
  }
}
```

---

### ููุงุญุธุงุช ุงูุชูููุฐ

* ูุนุชูุฏ ุนูู ูุญุฏุฉ ุชุญูู `Base` ููุญุตูู ุนูู ุณูุงู ุงููุณุชุฎุฏู/ุงููููุน
* ูุณุชุฎุฏู `think\facade\Db` ูุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
* ุฌุฏุงูู `msg_detect` ู `msg_wyccheck` ูุฌุจ ุฃู ุชุญุชูู ุนูู ุงูุฃุนูุฏุฉ ุงููุงุฒูุฉ
* ุงูุทูุงุจุน ุงูุฒูููุฉ ูุฎุฒูุฉ ูุฃุนุฏุงุฏ ุตุญูุญุฉ ููุธุงู Unix

